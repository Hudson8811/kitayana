"use strict";

document.addEventListener("DOMContentLoaded", function () {

  ymaps.ready(function () {
    new ymaps.Map("map", {
      center: [55.76, 37.64],
      zoom: 7
    }), new ymaps.Map("map-shops", o);
    new ymaps.Map("map-modal", o), new ymaps.Map("map-modal-mob", o), new ymaps.Map("map-modal-shop", o), new ymaps.Map("map-modal-stock", o), new ymaps.Map("filter-map-modal", o);
  })
  
  function e(e, t) {
    e.classList.contains("open") ? t.style.maxHeight = t.scrollHeight + "px" : t.style.maxHeight = null, e.addEventListener("click", function (s) {
      s.preventDefault(), e.classList.toggle("open"), e.classList.contains("open") ? t.style.maxHeight = t.scrollHeight + "px" : t.style.maxHeight = null;
    });
  }

  var t = document.querySelectorAll(".accordion"),
      s = document.querySelectorAll(".filters__box");
  t.forEach(function (t) {
    var s = t.querySelector(".accordion__content");
    e(t, s);
  }), s.forEach(function (t) {
    var s = t.closest(".filters__item").querySelector(".filters__content");
    e(t, s);
  });
  new Swiper(".swiper-spares", {
    direction: "horizontal",
    slidesPerView: "auto",
    breakpoints: {
      320: {
        spaceBetween: 16
      },
      576: {
        spaceBetween: 40
      }
    }
  });
  new Swiper(".car-service-slider", {
    direction: "horizontal",
    slidesPerView: "auto",
    spaceBetween: 16
  });
  var o = {
    center: [55.76, 37.64],
    zoom: 7
  };
  window.addEventListener("scroll", function () {
    this.pageYOffset > 140 ? document.querySelector(".header").classList.add("fixed") : document.querySelector(".header").classList.remove("fixed");
  }), $(".js-range-slider").ionRangeSlider({
    type: "double",
    min: 0,
    max: 1e3,
    from: 0,
    to: 500,
    hide_min_max: !0,
    hide_from_to: !0,
    onChange: function onChange(e) {
      $(".jsPriceFrom").val(e.from), $(".jsPriceTo").val(e.to);
    }
  });
  var n = document.querySelectorAll(".dropdown"),
      r = document.querySelector(".jsExpertButton"),
      l = document.querySelector(".jsExpertDropdown"),
      a = document.querySelector(".jsAuthButton"),
      i = document.querySelector(".jsButtonCars"),
      u = document.querySelector(".jsButtonFavourite"),
      v = document.querySelector(".jsBasketButton"),
      L = document.querySelector("body"),
      w = document.querySelector(".overlay");
    

      // РћС‚РєСЂС‹С‚РёРµ РјРѕРґР°Р»РѕРє 
      document.querySelectorAll('[data-popup]').forEach(btn => {
        btn.addEventListener('click', function(e){
          e.preventDefault();
          document.querySelector('.modal.open')?.classList.remove('open');
          let popupId = btn.getAttribute('data-popup');
          document.querySelector(`#${popupId}`).classList.add('open');
          L.classList.add("overflow-hidden");
          w.classList.add('open');
        })
      })

      // РћС‚РєСЂС‹С‚РёРµ РІС‹РїР°РґР°СЋС‰РёС… РѕРєРѕРЅ
      document.querySelectorAll('[data-dropdown]').forEach(btn => {
        btn.addEventListener('click', function(e){
          e.preventDefault();
          document.querySelector('.dropdown.open')?.classList.remove('open');
          let popupId = btn.getAttribute('data-dropdown');
          document.querySelector(`#${popupId}`).classList.add('open');
          L.classList.add("overflow-hidden");
          w.classList.add('open');
        })
      })


      // Р—Р°РєСЂС‹С‚РёРµ РјРѕРґР°Р»РѕРє
      document.querySelectorAll(".jsButtonCloseModal").forEach(function (e) {
        e.addEventListener("click", function (e) {
          e.preventDefault(), L.classList.remove("overflow-hidden");
          var t = document.querySelectorAll(".modal");
          w.classList.remove("open"), t.forEach(function (e) {
            e.classList.remove("open");
          });
        });
      });


      // Р—Р°РєСЂС‹С‚РёРµ РјРѕРґР°Р»РѕРє
      document.querySelectorAll(".jsBtnCloseDropdown").forEach(function (e) {
        e.addEventListener("click", function (e) {
          e.preventDefault(), L.classList.remove("overflow-hidden");
          var t = document.querySelectorAll(".dropdown");
          w.classList.remove("open"), t.forEach(function (e) {
            e.classList.remove("open");
          });
        });
      });

      // РћС‚РєСЂС‹С‚РёРµ РјРµРЅСЋ

      if(window.screen.width >= 991){
        document.querySelectorAll('.main-menu__col').forEach(menuItem => {
          menuItem.onmouseover = function(e){
            if(e.target.classList.contains('main-menu__col')){
              document.querySelectorAll('.main-menu__col.active').forEach(actives => {
                actives.classList.remove('active');
              })
              e.target.classList.add('active');
            }
          }
        })
      }else{
        document.querySelector('.main-menu__col.active').remove('active');
      }

      if(window.screen.width >= 768){
        r.onmouseover = function(){
          l.classList.add('open');
        };
        
        l.onmouseover = function(){
          l.classList.add('open');
        };
      
        l.onmouseout = function(){
          l.classList.remove('open');
        };
      }



  function y() {
    n.forEach(function (e) {
      e.classList.remove("open");
    }), L.classList.remove("overflow-hidden"), a?.classList.remove("active"), r?.classList.remove("active"), i?.classList.remove("active"), u.classList.remove("active"), v.classList.remove("active");
  }

 

  document.querySelector(".jsCloseFilter").addEventListener("click", function (e) {
      L.classList.remove("overflow-hidden")
      document.querySelector(".jsFilters").classList.remove("open");
  });

  document.querySelector(".jsBtnFilter").addEventListener("click", function (e) {
      e.preventDefault()
      L.classList.add("overflow-hidden")
      document.querySelector(".jsFilters").classList.add("open");
  });



  var f = document.querySelector(".jsMainMenu");
  document.querySelectorAll(".jsMenuButton").forEach(function (e) {
    e.addEventListener("click", function (e) {
     L.classList.toggle('menu-opened'), e.preventDefault(), y(), f.classList.toggle("open"), f.classList.contains("open") ? (this.classList.remove("--svg__menu"), this.classList.add("--svg__menu_close"), L.classList.add("overflow-hidden")) : (this.classList.add("--svg__menu"), this.classList.remove("--svg__menu_close"), L.classList.remove("overflow-hidden"));
    });
  });
  var h = 0;

  var q = document.querySelectorAll(".counter__icon.plus"),
      _ = document.querySelectorAll(".counter__icon.minus");

  q.forEach(function (e) {
    e.addEventListener("click", function (e) {
      e.preventDefault(), h++, this.previousElementSibling.value = h;
    });
  }), _.forEach(function (e) {
    e.addEventListener("click", function (e) {
      e.preventDefault();
      var t = this.nextElementSibling;
      h > 0 && (h--, t.value = h);
    });
  });
  document.querySelectorAll(".jsAddItemCart").forEach(function (e) {
    e.addEventListener("click", function (t) {
      t.preventDefault();
      e.nextElementSibling.classList.add("show");
    });
  })

  document.querySelectorAll(".jsToggleTypeButton").forEach(function (e) {
    e.addEventListener("click", function (e) {
      console.log("test1332"), e.preventDefault();
      var t = this.querySelector(".modal__type-icon"),
          s = this.querySelector("span"),
          o = this.closest(".modal__content").querySelector(".modal__type-wrapper--content"),
          c = this.closest(".modal__content").querySelector(".modal__type-wrapper--map");
      t.classList.contains("--svg__list") ? (t.classList.remove("--svg__list"), t.classList.add("--svg__pin"), s.textContent = "на карте", o.classList.remove("active"), c.classList.add("active")) : (t.classList.remove("--svg__pin"), t.classList.add("--svg__list"), s.textContent = "списком", c.classList.remove("active"), o.classList.add("active"));
    });
  });

   // auth tabs
   document.querySelectorAll('.dropdown--left [data-tab]').forEach(item => {
    item.addEventListener('click', function(e){
      e.preventDefault();
     
      let dataId = this.getAttribute('data-tab');
      let tabContent = document?.getElementById(dataId);
      document.querySelectorAll('.dropdown--left .tabs-content .tab').forEach(tab => {
        tab.classList.remove('open');
      })
      document.querySelectorAll('.dropdown--left [data-tab]').forEach(link => {
        link.classList.remove('active')
      })
      tabContent.classList.add('open');
      this.classList.add('active');
      console.log(tabContent);
    })
  });


  
  if(window.screen.width <= 768){
    document.querySelector('.header__search').addEventListener('focus', function(){
      document.querySelector('body').classList.add('search-open');
      document.querySelector('body').classList.add('overflow-hidden')
    })

    document.querySelector('.header__search-close').addEventListener('click', function(){
      document.querySelector('body').classList.remove('search-open');
      document.querySelector('body').classList.remove('overflow-hidden')
    })
    
  }else{
    document.querySelector('.header__search').addEventListener('focus', function(){
      document.querySelector('body').classList.add('search-open');
      document.querySelector('body').classList.add('overflow-hidden')
    })
  
    document.querySelector('.header__search').addEventListener('blur', function(){
      document.querySelector('body').classList.remove('search-open');
      document.querySelector('body').classList.remove('overflow-hidden')
    })
  }

});